<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>datef</title>
    <script src="datef.js"></script>
</head>
<body>
<script>
    const testCases = [];
    
    function add_unit_test(format, adjustments, date, expection) {
        testCases.push({
            format, adjustments, date, expection
        });
    }
    
    function test() {
        let testResults = {
            total: 0,
            success: 0,
            fail: 0,
            logs: []
        };
        
        let colors = {
            def: 'color:black;font-weight:normal;',
            num: 'color:blue;',
            succ: 'color:green;',
            err: 'color:red;font-weight:bold',
            ret: 'color:#9247ab;',
            exp: 'color:#1e808a;',
            js: 'color:#b1360f;'
        };
        
        for (let i=0; i<testCases.length; i++) {
            testResults.total ++;
            let testCase = testCases[i];
            let testJs = `datef('${testCase.format}', '${testCase.date}', '${testCase.adjustments}')`;
            let evalResult = eval(testJs);
            
            let testResult = {
                js: testJs,
                success: testCase.expection === evalResult,
                evalResult: evalResult,
                expection: testCase.expection
            };
            
            if(testResult.success) {
                testResults.success ++;
            } else {
                testResults.fail ++;
            }
    
            testResults.logs.push(testResult);
        }
        
        let succPercent = ((testResults.success / testResults.total)*100).toFixed(1) + '%';
        
        console.log(
            `总共测试 %c${testResults.total}%c 例，成功 %c${testResults.success}%c 例，失败 %c${testResults.fail}%c 例，成功率 %c${succPercent}`,
            colors.num, colors.def,
            colors.succ, colors.def,
            colors.err, colors.def,
            colors.num
        );
        
        for (let i=0; i<testResults.logs.length; i++) {
            let log = testResults.logs[i];
            
            if(log.success) {
                console.groupCollapsed(`%c成功%c ${log.js}`, colors.succ, colors.def);
                console.log(
                    `js=%c${log.js}%c\n   result=%c${log.evalResult}%c\nexpection=%c${log.expection}`,
                    colors.js, colors.def,
                    colors.ret, colors.def,
                    colors.exp
                );
                console.groupEnd();
            } else {
                console.log(
                    `%c失败%c   js=%c${log.js}%c\n   result=%c${log.evalResult}%c\nexpection=%c${log.expection}`,
                    colors.err, colors.def,
                    colors.js, colors.def,
                    colors.ret, colors.def,
                    colors.exp
                );
            }
        }
    
        console.log(
            `总共测试 %c${testResults.total}%c 例，成功 %c${testResults.success}%c 例，失败 %c${testResults.fail}%c 例，成功率 %c${succPercent}`,
            colors.num, colors.def,
            colors.succ, colors.def,
            colors.err, colors.def,
            colors.num
        );
    }
</script>
<script type="text/javascript">
    // 基础测试
    add_unit_test('Y-m-d H:i:s', '',         '2020-10-02 10:20:00', '2020-10-02 10:20:00');
    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '2020-09-28 16:30:49',
        '28 Mon 28 Monday 1 th 1 271 40 September 09 Sep 9 30 1 2020 2020 20 pm PM 4 16 16 30 49 1601310649'
    );

    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '2000-02-27 16:30:49',
        '27 Sun 27 Sunday 7 th 0 57 08 February 02 Feb 2 29 1 2000 2000 00 pm PM 4 16 16 30 49 951669049'
    );

    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '2000-12-30 16:30:49',
        '30 Sat 30 Saturday 6 th 6 364 52 December 12 Dec 12 31 1 2000 2000 00 pm PM 4 16 16 30 49 978193849'
    );

    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '2000-01-01 16:30:49',
        '01 Sat 1 Saturday 6 st 6 0 52 January 01 Jan 1 31 1 1999 2000 00 pm PM 4 16 16 30 49 946744249'
    );


    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '1993-01-01 16:30:49',
        '01 Fri 1 Friday 5 st 5 0 53 January 01 Jan 1 31 0 1992 1993 93 pm PM 4 16 16 30 49 725905849'
    );

    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '1993-12-30 16:30:49',
        '30 Thu 30 Thursday 4 th 4 363 52 December 12 Dec 12 31 0 1993 1993 93 pm PM 4 16 16 30 49 757269049'
    );

    add_unit_test('d D j l N S w z W F m M n t L o Y y a A g G H i s U', '',
        '1993-06-10 16:30:49',
        '10 Thu 10 Thursday 4 th 4 160 23 June 06 Jun 6 30 0 1993 1993 93 pm PM 4 16 16 30 49 739729849'
    );
    
    
    // adjustments 测试
    add_unit_test('Y-m-d H:i:s', '+1y',         '2020-10-02 10:20:00', '2021-10-02 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+4m',         '2020-10-02 10:20:00', '2021-02-02 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+16m',        '2020-10-02 10:20:00', '2022-02-02 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+1y3m',       '2020-10-02 10:20:00', '2022-01-02 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+3d',         '2020-10-02 10:20:00', '2020-10-05 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+1w',         '2020-10-02 10:20:00', '2020-10-09 10:20:00');
    add_unit_test('Y-m-d H:i:s', '+1y3m-10i',   '2020-10-02 10:20:00', '2022-01-02 10:10:00');
    add_unit_test('Y-m-d H:i:s', '+1y3m-10i5',  '2020-10-02 10:20:00', '2022-01-02 10:09:55');
    add_unit_test('Y-m-d H:i:s', '-5',          '2020-10-02 10:20:00', '2020-10-02 10:19:55');
    add_unit_test('Y-m-d H:i:s', '+600',        '2020-10-02 10:20:00', '2020-10-02 10:30:00');
</script>
<script>test();</script>
</body>
</html>
